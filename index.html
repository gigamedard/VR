<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Workspace (Client)</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>

    <style>
      #info-box {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background: white;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        font-family: sans-serif;
        z-index: 9999;
        text-align: center;
      }
      #pc-stream-video {
        display: none; /* La vid√©o source est cach√©e */
      }
    </style>
  </head>

  <body>
    <div id="info-box">Connexion au serveur...</div>

    <a-assets>
      <video id="pc-stream-video" autoplay loop="true" playsinline crossorigin="anonymous"></video>
    </a-assets>

    <a-scene>
      <a-entity camera look-controls></a-entity>

      <a-plane id="screen"
               width="2"
               height="1.125" position="0 1.5 -2.5"
               src="#pc-stream-video">
      </a-plane>
    </a-scene>

    <script>
      const infoBox = document.getElementById("info-box");
      const videoElement = document.getElementById("pc-stream-video");

      // 1. Initialiser PeerJS
      // (null = PeerJS nous donne un ID al√©atoire)
      const peer = new Peer(null, {
        // Tu peux laisser ces options par d√©faut
        debug: 2 
      });

      // 2. Quand la connexion au serveur PeerJS est faite...
      peer.on('open', (id) => {
        // ...on affiche notre ID.
        // C'est cet ID que tu devras entrer sur ton PC
        infoBox.innerHTML = `Entrez cet ID sur le PC : <br><strong>${id}</strong>`;
        console.log('Mon ID PeerJS est: ' + id);
      });

// 3. Quand quelqu'un (ton PC) essaie de "nous appeler"...
    peer.on('call', (call) => {

    // On r√©pond √† l'appel
    call.answer();

    // 4. Quand on re√ßoit le flux vid√©o...
    call.on('stream', (remoteStream) => {
        // ...on l'applique √† notre balise <video>
        videoElement.srcObject = remoteStream;

        // --- MODIFICATION ICI ---
        // AU LIEU de jouer la vid√©o, on affiche un bouton
        infoBox.innerHTML = "Stream re√ßu ! üöÄ<br><strong>(Tapez ici pour d√©marrer)</strong>";
        infoBox.style.cursor = "pointer"; // Change le curseur

        // On ajoute un "listener" de clic sur ce bouton
        infoBox.addEventListener('click', () => {
            videoElement.play();
            // On cache le bouton apr√®s le clic
            infoBox.style.display = 'none'; 
        }, { once: true }); // "once: true" supprime le listener apr√®s le clic
    });
});

      peer.on('error', (err) => {
        infoBox.innerText = `Erreur: ${err.type}`;
        console.error(err);
      });
    </script>
  </body>
</html>